<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App â€“ Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="app.js"></script>
</head>
<body>

<div class="dashboard-container">

    <!-- Account Panel -->
    <div class="account-panel">
        <h3>Account</h3>
        <button onclick="openAccountPopup()">Account</button>
        <button onclick="logout()">Logout</button>
        <div id="create-account-container">
            <button onclick="createNewAccount()">Create Account (Core/Pioneer)</button>
        </div>
    </div>

    <!-- Rooms -->
    <div class="room-panel">
        <h3>Rooms</h3>
        <div id="room-list"></div>
        <div id="room-info-panel">
            <ul id="room-members"></ul>
            <button id="join-room-btn" onclick="joinRoom()">Join Room</button>
        </div>
    </div>

</div>

<script>
// Load rooms dynamically
async function loadRooms() {
    const roomsRef = firebase.database().ref("rooms");
    const snap = await get(roomsRef);
    const list = document.getElementById("room-list");
    if (!list) return;
    list.innerHTML = "";
    if (snap.exists()) {
        Object.keys(snap.val()).forEach(room => {
            const btn = document.createElement("button");
            btn.textContent = room;
            btn.style.marginRight = "5px";
            btn.onclick = () => { loadRoomInfo(room); };
            list.appendChild(btn);
        });
    }
}
loadRooms();

// Load room members
async function loadRoomInfo(room) {
    const roomRef = firebase.database().ref("rooms/" + room + "/members");
    const snap = await get(roomRef);
    const membersList = document.getElementById("room-members");
    if (!membersList) return;
    membersList.innerHTML = "";
    if (snap.exists()) {
        Object.keys(snap.val()).forEach(m => {
            const li = document.createElement("li");
            li.textContent = m;
            membersList.appendChild(li);
        });
    }
}

// Join room
window.joinRoom = function() {
    const room = document.getElementById("room-members").previousSibling.textContent;
    window.location.href = `chat.html?room=${room}`;
};
</script>

</body>
</html>
