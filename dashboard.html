<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App â€“ Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="app.js"></script>
    <script type="module" src="chat.js"></script>
</head>
<body>
<div class="dashboard-container">

    <!-- Account Panel Button -->
    <button onclick="document.getElementById('account-popup').style.display='block'" class="button-link">Account</button>

    <!-- Room Buttons -->
    <div class="room-panel">
        <h3>Rooms</h3>
        <div id="room-list" style="display:flex; gap:5px; flex-wrap:wrap;">
            <!-- Rooms buttons dynamically created by JS -->
        </div>
    </div>

    <!-- Admin Core/Pioneer Create Accounts -->
    <div id="create-account-panel" style="margin-top:20px;">
        <button class="button-link" onclick="_CREATE_USER()" style="display:none;" id="core-create-btn">Create Account</button>
    </div>

</div>

<!-- Account Popup -->
<div id="account-popup" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px #000; z-index:1000; width:300px;">
    <h3>Account Settings</h3>
    <button class="button-link" onclick="_accPop()">Change Display Name</button>
    <button class="button-link" onclick="_accPop()">Change Password</button>
    <button class="button-link" onclick="startAuction(prompt('Title?'), prompt('Starting bid?'), prompt('Duration in minutes?'))">Start Auction</button>
    <button class="button-link" onclick="alert('Change equipped title (placeholder)')">Change Title</button>
    <button class="button-link" onclick="openShop()">Open Shop</button>
    <button class="button-link" onclick="_LOGOUT()">Logout</button>
    <br><br>
    <button onclick="document.getElementById('account-popup').style.display='none'" class="button-link">Close</button>
</div>

<script>
    // Show create account button if user is core/pioneer
    window.addEventListener('load', () => {
        const user = JSON.parse(localStorage.getItem("currentUser") || "{}");
        if(["core","pioneer"].includes(user.rank)){
            document.getElementById('core-create-btn').style.display='inline-block';
        }
    });

    // Load room buttons
    async function loadRooms() {
        const roomsRef = ref(db, "rooms");
        onValue(roomsRef, snapshot => {
            const roomList = document.getElementById("room-list");
            roomList.innerHTML = "";
            snapshot.forEach(child=>{
                const code = child.key;
                const btn = document.createElement("button");
                btn.textContent = code;
                btn.classList.add("button-link");
                btn.style.marginRight="5px";
                // On click, show room info panel (members/banned/muted)
                btn.onclick = () => window.loadRoomInfo();
                roomList.appendChild(btn);
            });
        });
    }

    loadRooms();
</script>
</body>
</html>
