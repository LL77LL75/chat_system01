<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="top-bar">
  <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
  <div>
    <button onclick="logout()">Logout</button>
    <button onclick="openAccountPopup()">Account</button>
    <button onclick="openUserList()">UsrLst</button>
  </div>
</div>

<h2>Dashboard</h2>
<h3>Rooms</h3>
<div id="room-list" class="panel"></div>
<div id="room-info-panel" class="panel"></div>

<!-- ACCOUNT POPUP -->
<div id="account-popup" class="popup">
  <div class="popup-content">
    <h3>Account Settings</h3>
    <label>Display Name:</label>
    <input id="displayname-input" />
    <button onclick="changeDisplayName()">Save Display Name</button>
    <br><br>
    <label>Active Title:</label>
    <select id="title-select"></select>
    <button onclick="setActiveTitle()">Equip Title</button>
    <br><br>
    <button onclick="closeAccountPopup()">Close</button>
  </div>
</div>

<!-- USERLIST POPUP -->
<div id="userlist-popup" class="popup">
  <div class="popup-content">
    <h3>Active Users</h3>
    <ul id="userlist"></ul>
    <button onclick="closeUserList()">Close</button>
  </div>
</div>

<script type="module" src="app.js"></script>
<script type="module">
window.onload = () => {
  if (!window.currentUser) {
    location.href = "index.html";
    return;
  }
  if (typeof window.loadRooms === "function") window.loadRooms();

  // Load active users
  const userlistEl = document.getElementById("userlist");
  const usersRef = firebase.database().ref("users");
  onValue(usersRef, snap => {
    userlistEl.innerHTML = "";
    snap.forEach(uSnap => {
      const u = uSnap.key;
      const data = uSnap.val();
      const li = document.createElement("li");
      li.textContent = `${u} (${data.rank || "newbie"})`;
      if (data.banned) li.classList.add("user-banned");
      if (data.muted) li.classList.add("user-muted");
      userlistEl.appendChild(li);
    });
  });
};
</script>
</body>
</html>
